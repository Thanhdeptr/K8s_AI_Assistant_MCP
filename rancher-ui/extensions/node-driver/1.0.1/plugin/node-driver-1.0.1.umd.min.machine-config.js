(("undefined"!==typeof self?self:this)["webpackChunknode_driver_1_0_1"]=("undefined"!==typeof self?self:this)["webpackChunknode_driver_1_0_1"]||[]).push([[921],{4247:function(e,t,a){"use strict";a.d(t,{P:function(){return n}});var s=a(4364);function i(e,t,a){return(t=o(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e){var t=l(e,"string");return"symbol"==typeof t?t:t+""}function l(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class n{constructor(e,t){i(this,"domainName",""),i(this,"endpoint",""),i(this,"projectDomainName",""),i(this,"projectId",""),i(this,"projectName",""),i(this,"username",""),i(this,"password",""),i(this,"token",""),i(this,"region",""),i(this,"catalog",void 0),i(this,"endpoints",void 0),i(this,"userId",""),i(this,"$dispatch",void 0),i(this,"regionsFromCatalog",[]),t.annotations?Object.keys(t.annotations).forEach((e=>{const a=e.split("/");if(2===a.length&&"openstack.cattle.io"===a[0]){const s=a[1];this[s]=t.annotations[e]}})):Object.keys(t).forEach((e=>{this[e]=t[e]})),this.$dispatch=e.dispatch}async getToken(){const e=this.endpoint.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,a=`${t}/auth/tokens`,i={auth:{identity:{methods:["password"],password:{user:{name:this.username,domain:{name:this.domainName},password:this.password}}}}};this.projectName&&(i.auth.scope={project:{name:this.projectName,domain:{name:this.projectDomainName}}});const o={Accept:"application/json"};try{const e=await this.$dispatch("management/request",{url:a,headers:o,method:"POST",redirectUnauthorized:!1,data:i},{root:!0});if(502===e._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const t=e._headers["x-subject-token"];return this.token=t,this.userId=e?.token?.user?.id,this.regionsFromCatalog=[],i.auth.scope&&e?.token&&(this.catalog=e.token.catalog,this.endpoints={},this.catalog.forEach((e=>{const t=e.endpoints.find((e=>"public"===e.interface));t&&t.region_id===this.region&&(this.endpoints[e.type]=t.url),t&&"compute"===e.type&&(this.regionsFromCatalog.includes(t.region_id)||this.regionsFromCatalog.push(t.region_id))}))),this.regionsFromCatalog=this.regionsFromCatalog.map((e=>({id:e}))),e}catch(l){return s.error(l),{error:l}}}async getFlavors(e,t){return await this.getOptions(e,"/flavors","flavors",void 0,t)}async getImages(e,t){return await this.getOptions(e,"/images/detail","images",void 0,t)}async getKeyPairs(e,t){return await this.getOptions(e,"/os-keypairs","keypairs",(e=>e.keypair),t)}async getSecurityGroups(e,t){return await this.getOptions(e,"/os-security-groups","security_groups",void 0,t)}async getFloatingIpPools(e,t){return await this.getOptions(e,"/os-floating-ip-pools","floating_ip_pools",void 0,t)}async getNetworkNames(e,t){return await this.getOptions(e,"/os-tenant-networks","networks",(e=>({...e,name:e.label})),t)}async getAvailabilityZones(e,t){return await this.getOptions(e,"/os-availability-zone","availabilityZoneInfo",(e=>({...e,name:e.zoneName})),t)}async getOptions(e,t,a,s,i){e.busy=!0,e.enabled=!0,e.selected="";const o=await this.makeComputeRequest(t);if(o&&o[a]){let t=o[a]||[];if(s&&(t=t.map((e=>s(e)))),e.options=this.convertToOptions(t),e.busy=!1,i){const t=e.options.find((e=>e.value.name===i));t&&(e.selected=t.value)}!e.selected&&e.options.length>0&&(e.selected=e.options[0].value)}else e.options=[],e.selected=null,e.busy=!1,e.enabled=!1}async makeComputeRequest(e){const t=this.endpoints["compute"].replace(/^https?:\/\//,""),a=`/meta/proxy/${t}`,i=`${a}${e}`,o={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:i,headers:o,method:"GET",redirectUnauthorized:!1},{root:!0});return e}catch(l){s.error(l)}}async getProjects(){const e=this.endpoint.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,a={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/users/${this.userId}/projects`,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return e?.projects}catch(i){return s.error(i),{error:i}}}async getRegions(){const e=this.endpoint.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,a={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/regions`,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return e?.regions}catch(i){return s.error(i),{error:i}}}convertToOptions(e){const t=(e||[]).sort(((e,t)=>e.name.localeCompare(t.name)));return t.map((e=>({label:e.name,value:e})))}}},6158:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return W}});var s=a(9274);const i=e=>((0,s.pushScopeId)("data-v-21bd070e"),e=e(),(0,s.popScopeId)(),e),o={key:1},l={class:"openstack-config"},n=i((()=>(0,s.createElementVNode)("div",{class:"title"}," Openstack Configuration ",-1))),r={key:0,class:"loading"},d=i((()=>(0,s.createElementVNode)("i",{class:"icon-spinner icon-spin icon-lg"},null,-1))),c=i((()=>(0,s.createElementVNode)("span",null," Authenticating with the Openstack server ... ",-1))),u=[d,c],p={class:"row mt-10"},h={class:"col span-6"},m={class:"col span-6"},y={class:"row mt-10"},v={class:"col span-6"},g={class:"col span-6"},f={class:"file-button"},b={class:"row mt-10"},k={class:"col span-6"},w={class:"row mt-10"},N={class:"col span-6"},V={class:"row mt-10"},P={class:"col span-6"},E={class:"col span-6"},F={class:"row mt-10"},$={class:"col span-6"};function C(e,t,a,i,d,c){const C=(0,s.resolveComponent)("Loading"),I=(0,s.resolveComponent)("Banner"),S=(0,s.resolveComponent)("LabeledSelect"),O=(0,s.resolveComponent)("FileSelector"),j=(0,s.resolveComponent)("LabeledInput");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(C,{key:0,delayed:!0})):(0,s.createCommentVNode)("",!0),d.errors.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",o,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(d.errors,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t},[(0,s.createVNode)(I,{color:"error",label:c.stringify(e)},null,8,["label"])])))),128))])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("div",l,[n,d.authenticating?((0,s.openBlock)(),(0,s.createElementBlock)("div",r,u)):(0,s.createCommentVNode)("",!0)]),(0,s.createElementVNode)("div",p,[(0,s.createElementVNode)("div",h,[(0,s.createVNode)(S,{modelValue:d.flavors.selected,"onUpdate:modelValue":t[0]||(t[0]=e=>d.flavors.selected=e),label:"Flavor",options:d.flavors.options,disabled:!d.flavors.enabled||a.busy,loading:d.flavors.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])]),(0,s.createElementVNode)("div",m,[(0,s.createVNode)(S,{modelValue:d.images.selected,"onUpdate:modelValue":t[1]||(t[1]=e=>d.images.selected=e),label:"Image",options:d.images.options,disabled:!d.images.enabled||a.busy,loading:d.images.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])])]),(0,s.createElementVNode)("div",y,[(0,s.createElementVNode)("div",v,[(0,s.createVNode)(S,{modelValue:d.keyPairs.selected,"onUpdate:modelValue":t[2]||(t[2]=e=>d.keyPairs.selected=e),label:"Key Pair",options:d.keyPairs.options,disabled:!d.keyPairs.enabled||a.busy,loading:d.keyPairs.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])]),(0,s.createElementVNode)("div",g,[(0,s.createVNode)(j,{modelValue:d.filename,"onUpdate:modelValue":t[3]||(t[3]=e=>d.filename=e),label:"Private Key",mode:e.mode,type:d.privateKeyFieldType,disabled:a.busy,required:!0},{suffix:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",f,[(0,s.createVNode)(O,{label:"...",mode:e.mode,"include-file":!0,disabled:a.busy,class:"btn-sm",onSelected:c.onPrivateKeyFileSelected},null,8,["mode","disabled","onSelected"])])])),_:1},8,["modelValue","mode","type","disabled"])])]),(0,s.createElementVNode)("div",b,[(0,s.createElementVNode)("div",k,[(0,s.createVNode)(S,{modelValue:d.securityGroups.selected,"onUpdate:modelValue":t[4]||(t[4]=e=>d.securityGroups.selected=e),label:"Security Groups",options:d.securityGroups.options,disabled:!d.securityGroups.enabled||a.busy,loading:d.securityGroups.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])])]),(0,s.createElementVNode)("div",w,[(0,s.createElementVNode)("div",N,[(0,s.createVNode)(S,{modelValue:d.availabilityZones.selected,"onUpdate:modelValue":t[5]||(t[5]=e=>d.availabilityZones.selected=e),label:"Availability Zone",options:d.availabilityZones.options,disabled:!d.availabilityZones.enabled||a.busy,loading:d.availabilityZones.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])])]),(0,s.createElementVNode)("div",V,[(0,s.createElementVNode)("div",P,[(0,s.createVNode)(S,{modelValue:d.floatingIpPools.selected,"onUpdate:modelValue":t[6]||(t[6]=e=>d.floatingIpPools.selected=e),label:"Floating IP Pools",options:d.floatingIpPools.options,disabled:!d.floatingIpPools.enabled||a.busy,loading:d.floatingIpPools.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])]),(0,s.createElementVNode)("div",E,[(0,s.createVNode)(S,{modelValue:d.networks.selected,"onUpdate:modelValue":t[7]||(t[7]=e=>d.networks.selected=e),label:"Networks",options:d.networks.options,disabled:!d.networks.enabled||a.busy,loading:d.networks.busy,searchable:!1},null,8,["modelValue","options","disabled","loading"])])]),(0,s.createElementVNode)("div",F,[(0,s.createElementVNode)("div",$,[(0,s.createVNode)(j,{modelValue:d.sshUser,"onUpdate:modelValue":t[8]||(t[8]=e=>d.sshUser=e),mode:e.mode,disabled:a.busy,required:!0,label:"SSH User ID"},null,8,["modelValue","mode","disabled"])])])])])}var I=a(4409),S=a(9980),O=a(240),j=a(985),U=a(5689),B=a(5664),A=a(9726),_=a(4220);const x=["disabled"],G=["multiple","webkitdirectory"];function T(e,t,a,i,o,l){return l.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,disabled:a.disabled,type:"button",class:"file-selector btn",onClick:t[1]||(t[1]=(...e)=>l.selectFile&&l.selectFile(...e))},[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(a.label),1),(0,s.createElementVNode)("input",{ref:"uploader",type:"file",class:"hide",multiple:a.multiple,webkitdirectory:a.directory,onChange:t[0]||(t[0]=(...e)=>l.fileChange&&l.fileChange(...e))},null,40,G)],8,x))}a(6978);var L={props:{label:{type:String,required:!0},mode:{type:String,default:_.G5},disabled:{type:Boolean,default:!1},includeFileName:{type:Boolean,default:!1},showGrowlError:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},byteLimit:{type:Number,default:0},readAsDataUrl:{type:Boolean,default:!1},directory:{type:Boolean,default:!1},rawData:{type:Boolean,default:!1},includeFile:{type:Boolean,default:!1}},computed:{isView(){return this.mode===_.nW}},methods:{selectFile(){this.$refs.uploader.value=null,this.$refs.uploader.click()},async fileChange(e){const t=e.target,a=Array.from(t.files||[]);if(this.byteLimit)for(const s of a)if(s.size>this.byteLimit)return void this.$emit("error",`${s.name} exceeds the file size limit of ${this.byteLimit} bytes`);if(this.rawData){const e=this.multiple||1!==a.length?a:a[0];this.$emit("selected",e)}else try{const e=a.map(this.getFileContents),t=await Promise.all(e),s=this.multiple||1!==t.length?t:t[0];if(this.includeFile)return this.$emit("selected",{file:this.multiple||1!==t.length?a:a[0],data:s});this.$emit("selected",s)}catch(A){this.$emit("error",A),this.showGrowlError&&this.$store.dispatch("growl/fromError",{title:"Error reading file",error:A},{root:!0})}},getFileContents(e){return new Promise(((t,a)=>{const s=new FileReader;s.onload=a=>{const s=a.target.result,i=e.name,o=this.includeFileName?{value:s,name:i}:s;t(o)},s.onerror=e=>{a(e)},this.readAsDataUrl?s.readAsDataURL(e):s.readAsText(e)}))}}},D=a(7433);const K=(0,D.A)(L,[["render",T]]);var Z=K,q=a(4247),R=a(4364);function z(){return{options:[],selected:null,busy:!1,enabled:!1}}var M={components:{Banner:S.l,FileSelector:Z,Loading:I.A,LabeledInput:U.o,LabeledSelect:j.A},mixins:[O.A],props:{uuid:{type:String,required:!0},cluster:{type:Object,default:()=>({})},credentialId:{type:String,required:!0},disabled:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},provider:{type:String,required:!0}},async fetch(){if(this.errors=[],!this.credentialId)return;if(this.mode===_.nW)return void this.initForViewMode();try{this.credential=await this.$store.dispatch("rancher/find",{type:B.k$.CLOUD_CREDENTIAL,id:this.credentialId})}catch(t){this.credential=null}try{const e=this.credentialId.replace(":","/"),t=await this.$store.dispatch("management/find",{type:B.bB,id:e}),a=t.data["openstackcredentialConfig-password"],s=atob(a);this.password=s,this.havePassword=!0,this.ready=!0}catch(t){this.password="",this.havePassword=!1,R.error(t)}this.$set(this,"authenticating",!0);const e=new q.P(this.$store,this.credential);e.password=this.password,this.os=e,this.os.getToken().then((t=>{if(t.error)return this.$set(this,"authenticating",!1),this.$emit("validationChanged",!1),void this.errors.push("Unable to authenticate with the OpenStack server");this.$set(this,"authenticating",!1),e.getFlavors(this.flavors,this.value?.flavorName),e.getImages(this.images,this.value?.imageName),e.getKeyPairs(this.keyPairs,this.value?.keypairName),e.getSecurityGroups(this.securityGroups,this.value?.secGroups),e.getFloatingIpPools(this.floatingIpPools,this.value?.floatingipPool),e.getNetworkNames(this.networks,this.value?.netName),e.getAvailabilityZones(this.availabilityZones,this.value?.availabilityZone)})),this.$emit("validationChanged",!1)},data(){return{authenticating:!1,ready:!1,os:null,password:null,havePassword:!1,flavors:z(),images:z(),keyPairs:z(),securityGroups:z(),floatingIpPools:z(),networks:z(),availabilityZones:z(),sshUser:this.value?.sshUser||"root",privateKeyFile:this.value?.privateKeyFile||"",filename:this.value?.privateKeyFile?"Private Key Provided":"",privateKeyFieldType:"password",errors:null}},watch:{credentialId(){this.$fetch()}},methods:{stringify:A.As,initForViewMode(){this.fakeSelectOptions(this.flavors,this.value?.flavorName),this.fakeSelectOptions(this.images,this.value?.imageName),this.fakeSelectOptions(this.keyPairs,this.value?.keypairName),this.fakeSelectOptions(this.securityGroups,this.value?.secGroups),this.fakeSelectOptions(this.floatingIpPools,this.value?.floatingipPool),this.fakeSelectOptions(this.networks,this.value?.netName),this.fakeSelectOptions(this.availabilityZones,this.value?.availabilityZone)},fakeSelectOptions(e,t){e.busy=!1,e.enabled=!1,e.options=[],t&&e.options.push({label:t,value:t}),e.selected=t},onPrivateKeyFileSelected(e){this.filename=e.file.name,this.privateKeyFile=e.data,this.privateKeyFieldType="text",this.$emit("validationChanged",!0)},syncValue(){this.value.authUrl=this.os.endpoint,this.value.domainName=this.os.domainName,this.value.tenantDomainName=this.os.projectDomainName,this.value.username=this.os.username,this.value.userDomainName=this.os.domainName,this.value.tenantId=this.os.projectId,this.value.tenantName=this.os.projectName,this.value.availabilityZone=this.availabilityZones.selected?.name,this.value.flavorName=this.flavors.selected?.name,this.value.imageName=this.images.selected?.name,this.value.floatingipPool=this.floatingIpPools.selected?.name,this.value.keypairName=this.keyPairs.selected?.name,this.value.netName=this.networks.selected?.name,this.value.secGroups=this.securityGroups.selected?.name,this.value.sshUser=this.sshUser,this.value.privateKeyFile=this.privateKeyFile,this.value.region=this.os.region,this.value.endpointType="publicURL",this.value.insecure=!0,this.value.bootFromVolume=!1,this.value.sshPort="22"},test(){this.syncValue()}}};a(5337);const X=(0,D.A)(M,[["render",C],["__scopeId","data-v-21bd070e"]]);var W=X},8249:function(e,t,a){"use strict";a.r(t);var s=a(6758),i=a.n(s),o=a(6173),l=a.n(o),n=l()(i());n.push([e.id,".file-button[data-v-21bd070e]{align-items:center;position:absolute;top:0;right:0;height:100%;display:flex}.file-button>.file-selector[data-v-21bd070e]{height:59px;border-top-left-radius:0;border-bottom-left-radius:0}.openstack-config[data-v-21bd070e]{display:flex;align-items:center}.openstack-config>.title[data-v-21bd070e]{font-weight:700;padding:4px 0}.openstack-config>.loading[data-v-21bd070e]{margin-left:20px;display:flex;align-items:center}.openstack-config>.loading>i[data-v-21bd070e]{margin-right:4px}",""]),t["default"]=n},5337:function(e,t,a){var s=a(8249);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var i=a(4825).A;i("23554420",s,!0,{sourceMap:!1,shadowMode:!1})},1177:function(e,t,a){var s={"./csp/metadata.json":6471,"./federal/metadata.json":1862,"./harvester/metadata.json":1507,"./rgs/metadata.json":8401,"./suse/metadata.json":7259};function i(e){var t=o(e);return a(t)}function o(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}i.keys=function(){return Object.keys(s)},i.resolve=o,e.exports=i,i.id=1177}}]);
//# sourceMappingURL=node-driver-1.0.1.umd.min.machine-config.js.map